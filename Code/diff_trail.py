from sbox import SBox
from fhe import FHE_Round
from tqdm import tqdm

"""
	Generates SBox objects from hard coded 6x4 mappings
"""
def getSBoxes6x4():

	mappings_6_4 = [
		[10, 4, 2, 3, 10, 15, 12, 6, 6, 9, 11, 5, 1, 11, 0, 1, 9, 12, 8, 14, 14, 15, 8, 11, 2, 10, 1, 6, 12, 13, 8, 2, 0, 3, 11, 0, 9, 7, 10, 7, 12, 1, 3, 3, 13, 4, 7, 9, 7, 14, 5, 14, 15, 2, 8, 13, 4, 4, 13, 15, 5, 0, 6, 5],
		[3, 8, 1, 1, 15, 10, 15, 13, 9, 11, 15, 5, 6, 14, 6, 12, 6, 1, 5, 5, 7, 11, 14, 0, 8, 6, 2, 12, 4, 10, 4, 3, 1, 3, 4, 0, 2, 10, 3, 10, 8, 7, 0, 13, 15, 12, 7, 13, 11, 2, 2, 9, 5, 7, 9, 4, 8, 9, 14, 12, 11, 0, 14, 13],
		[4, 4, 4, 4, 2, 7, 9, 11, 7, 12, 5, 11, 1, 1, 13, 7, 15, 0, 6, 14, 13, 2, 3, 14, 8, 10, 6, 12, 9, 10, 11, 2, 15, 0, 12, 1, 8, 15, 5, 12, 9, 6, 8, 10, 13, 11, 15, 14, 5, 5, 7, 14, 6, 10, 3, 1, 3, 13, 0, 0, 8, 2, 3, 9],
		[7, 13, 10, 12, 7, 10, 6, 6, 6, 15, 7, 10, 11, 14, 0, 2, 2, 3, 15, 4, 11, 13, 8, 12, 6, 8, 9, 8, 1, 1, 15, 9, 11, 15, 5, 14, 1, 3, 9, 14, 3, 12, 12, 4, 9, 14, 0, 5, 4, 8, 13, 3, 7, 0, 5, 4, 5, 10, 0, 2, 11, 1, 2, 13],
		[3, 8, 1, 1, 15, 10, 15, 13, 9, 11, 15, 5, 6, 14, 6, 12, 13, 1, 5, 5, 7, 11, 14, 0, 8, 6, 2, 12, 4, 10, 4, 3, 1, 3, 4, 0, 2, 10, 3, 10, 8, 7, 0, 13, 15, 12, 7, 6, 11, 2, 2, 9, 5, 7, 9, 4, 8, 9, 14, 14, 12, 0, 13, 11],
		[8, 0, 6, 14, 10, 9, 4, 9, 9, 4, 2, 11, 5, 1, 8, 14, 11, 1, 5, 15, 7, 11, 3, 8, 2, 2, 13, 12, 0, 3, 14, 7, 3, 15, 0, 10, 7, 15, 7, 6, 1, 10, 6, 8, 0, 4, 11, 13, 1, 2, 10, 3, 12, 5, 9, 12, 13, 6, 4, 15, 5, 13, 12, 14],
		[3, 8, 1, 1, 15, 10, 15, 13, 9, 11, 15, 5, 6, 14, 12, 12, 6, 1, 5, 5, 7, 11, 14, 0, 8, 6, 2, 12, 4, 10, 4, 3, 1, 3, 4, 2, 13, 14, 0, 0, 9, 10, 0, 5, 8, 2, 2, 9, 15, 4, 7, 7, 11, 13, 7, 14, 13, 6, 8, 3, 12, 9, 11, 10],
		[4, 4, 4, 4, 2, 15, 9, 11, 7, 12, 5, 11, 1, 1, 13, 15, 7, 0, 6, 14, 13, 2, 3, 14, 8, 10, 6, 12, 9, 10, 11, 2, 15, 0, 12, 1, 8, 7, 5, 12, 9, 6, 8, 10, 13, 11, 15, 14, 5, 5, 7, 14, 6, 10, 3, 1, 3, 13, 2, 9, 0, 3, 8, 0],
		[10, 4, 2, 3, 10, 15, 12, 6, 6, 9, 11, 5, 1, 11, 0, 1, 9, 12, 8, 14, 14, 15, 8, 11, 2, 10, 1, 6, 12, 14, 8, 2, 0, 3, 11, 0, 9, 15, 10, 7, 12, 1, 3, 3, 13, 4, 7, 9, 7, 4, 13, 6, 15, 14, 2, 8, 5, 5, 7, 4, 0, 13, 13, 5],
		[4, 13, 10, 12, 7, 10, 6, 6, 6, 15, 7, 10, 11, 14, 0, 2, 2, 3, 15, 4, 11, 13, 8, 12, 6, 8, 3, 8, 1, 1, 15, 9, 11, 15, 5, 14, 1, 3, 9, 14, 9, 12, 12, 7, 9, 14, 0, 5, 4, 8, 13, 3, 7, 0, 5, 5, 13, 4, 2, 0, 11, 2, 1, 10],
		[10, 4, 2, 3, 10, 15, 12, 6, 6, 9, 11, 5, 1, 11, 0, 1, 9, 12, 8, 14, 14, 15, 8, 11, 2, 10, 1, 6, 12, 14, 8, 2, 0, 3, 11, 0, 9, 7, 10, 7, 12, 1, 3, 3, 13, 4, 7, 9, 7, 15, 4, 4, 13, 0, 6, 2, 5, 15, 14, 8, 13, 5, 13, 5],
		[3, 8, 1, 1, 15, 10, 15, 13, 9, 11, 15, 5, 6, 14, 6, 14, 13, 1, 5, 4, 7, 11, 14, 0, 8, 6, 2, 12, 4, 10, 4, 3, 1, 3, 5, 0, 2, 10, 3, 10, 8, 7, 0, 13, 9, 12, 7, 6, 11, 2, 2, 15, 9, 12, 5, 7, 9, 4, 8, 14, 12, 0, 13, 11],
		[15, 9, 11, 12, 11, 0, 9, 5, 8, 7, 10, 10, 3, 6, 15, 12, 1, 4, 6, 3, 3, 10, 12, 13, 8, 2, 7, 1, 2, 4, 0, 14, 5, 6, 15, 5, 8, 2, 13, 14, 13, 9, 8, 4, 4, 2, 11, 1, 7, 0, 14, 12, 9, 0, 6, 11, 15, 14, 5, 7, 10, 3, 1, 13],
		[3, 3, 4, 0, 6, 12, 15, 9, 12, 0, 7, 2, 9, 11, 0, 2, 4, 8, 14, 12, 11, 6, 14, 5, 9, 5, 8, 1, 0, 1, 5, 4, 9, 2, 1, 10, 10, 7, 6, 2, 11, 3, 4, 3, 5, 6, 10, 13, 7, 1, 13, 12, 15, 8, 13, 11, 15, 14, 14, 13, 8, 10, 7, 15],
		[4, 4, 4, 4, 2, 15, 9, 11, 7, 12, 5, 11, 1, 1, 13, 15, 7, 0, 6, 14, 13, 2, 3, 14, 8, 10, 6, 12, 9, 9, 11, 2, 15, 0, 12, 1, 9, 7, 5, 12, 10, 6, 8, 10, 13, 11, 15, 14, 5, 5, 7, 14, 2, 1, 10, 6, 0, 3, 8, 13, 3, 8, 0, 3],
		[10, 4, 2, 3, 10, 15, 12, 6, 6, 9, 11, 5, 1, 11, 0, 1, 9, 12, 8, 14, 14, 15, 8, 11, 2, 10, 1, 6, 12, 14, 8, 2, 0, 3, 11, 0, 9, 7, 10, 15, 4, 4, 4, 7, 12, 1, 13, 7, 0, 6, 13, 2, 3, 13, 5, 15, 14, 9, 5, 3, 8, 5, 7, 13]
	]

	sboxes_6_4 = []
	for mapping in mappings_6_4:
		sboxes_6_4.append(SBox(6, 4, mapping))

	return sboxes_6_4


"""
	Generates SBox objects from hard coded 8x8 mappings
"""
def getSBoxes8x8():
	mappings_8_8 = [
		[85, 163, 206, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 180, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 30, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 246, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 110, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 237, 225, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 40, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 197, 211, 77, 125, 15, 3, 229, 220, 91, 16, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 191, 214, 20, 4, 106, 29, 185, 11, 189, 231, 61, 53, 135, 195, 13, 87, 119, 57, 74, 107, 117, 244, 126, 6],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 180, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 62, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 35, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 246, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 6, 189, 214, 231, 29, 4, 40, 74, 20, 61, 11, 191, 117, 126, 106, 185, 244, 13, 87, 57, 53, 107, 119, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 180, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 62, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 35, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 246, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 6, 189, 214, 231, 29, 4, 40, 74, 20, 61, 11, 191, 117, 126, 106, 185, 244, 13, 87, 57, 53, 107, 119, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 180, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 62, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 70, 195, 228, 8, 41, 243, 72, 2, 217, 54, 35, 19, 36, 192, 48, 126, 145, 53, 211, 11, 131, 1, 218, 75, 235, 50, 84, 37, 93, 22, 230, 87, 170, 237, 5, 111, 204, 186, 239, 21, 194, 3, 221, 32, 7, 178, 27, 45, 76, 193, 116, 56, 154, 207, 106, 196, 245, 29, 185, 134, 169, 43, 142, 215, 52, 12, 148, 17, 23, 224, 34, 200, 146, 189, 219, 18, 82, 165, 118, 110, 240, 121, 198, 55, 63, 147, 162, 156, 179, 47, 208, 81, 143, 98, 127, 133, 152, 164, 120, 188, 216, 166, 140, 64, 129, 177, 38, 31, 60, 0, 242, 251, 176, 254, 236, 101, 9, 39, 190, 209, 226, 108, 66, 103, 42, 246, 58, 158, 25, 130, 14, 222, 114, 233, 138, 30, 149, 79, 241, 10, 173, 168, 160, 155, 153, 159, 172, 213, 99, 26, 80, 109, 183, 199, 203, 234, 252, 248, 71, 78, 104, 174, 232, 202, 46, 65, 49, 206, 197, 77, 125, 15, 229, 225, 220, 91, 16, 44, 175, 205, 67, 73, 132, 151, 182, 249, 102, 88, 247, 141, 86, 97, 187, 115, 123, 28, 113, 100, 227, 181, 255, 171, 191, 214, 20, 4, 107, 74, 244, 117, 57, 231, 40, 6, 61, 119, 13, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 180, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 62, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 35, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 246, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 126, 106, 29, 185, 117, 18, 40, 11, 189, 231, 61, 53, 135, 74, 244, 214, 119, 87, 191, 107, 171, 20, 6, 37, 13, 4, 57],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 180, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 62, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 35, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 246, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 45, 15, 3, 229, 225, 220, 91, 16, 237, 107, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 191, 214, 119, 74, 40, 87, 117, 231, 185, 189, 20, 244, 53, 6, 126, 29, 61, 11, 13, 4, 44, 135, 106, 57],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 180, 64, 129, 177, 38, 174, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 191, 214, 117, 11, 6, 40, 244, 13, 4, 87, 61, 231, 57, 53, 107, 189, 185, 20, 119, 74, 126, 135, 29, 106],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 180, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 191, 214, 20, 4, 107, 189, 53, 74, 244, 106, 117, 57, 231, 40, 126, 29, 6, 185, 61, 87, 11, 119, 13, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 180, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 187, 243, 36, 126, 53, 11, 84, 37, 22, 87, 170, 237, 32, 45, 154, 106, 29, 185, 52, 34, 189, 18, 6, 107, 40, 88, 181, 214, 100, 249, 231, 16, 86, 220, 4, 91, 182, 132, 102, 74, 20, 61, 205, 115, 44, 175, 67, 113, 227, 28, 119, 73, 97, 57, 244, 123, 13, 117, 255, 151, 191, 135, 171, 247, 141],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 180, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 246, 56, 146, 58, 145, 158, 12, 126, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 154, 115, 123, 28, 170, 113, 84, 100, 227, 189, 34, 255, 18, 171, 37, 191, 214, 20, 4, 107, 181, 53, 74, 244, 106, 117, 57, 231, 40, 25, 29, 6, 185, 61, 87, 11, 119, 13, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 180, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 154, 115, 123, 28, 170, 113, 84, 100, 227, 189, 34, 255, 18, 171, 37, 181, 6, 214, 231, 29, 4, 40, 74, 20, 61, 11, 191, 117, 126, 106, 185, 244, 13, 87, 57, 53, 107, 119, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 180, 121, 198, 225, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 169, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 191, 214, 20, 4, 126, 106, 29, 185, 11, 189, 6, 40, 13, 231, 117, 74, 61, 53, 135, 87, 119, 57, 107, 244],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 180, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 36, 126, 32, 45, 154, 106, 29, 185, 243, 237, 11, 34, 189, 18, 231, 100, 151, 61, 141, 88, 187, 53, 28, 135, 52, 40, 249, 13, 170, 182, 84, 115, 171, 87, 119, 102, 57, 205, 175, 132, 214, 22, 74, 247, 73, 117, 191, 97, 67, 20, 123, 4, 181, 227, 107, 6, 86, 113, 44, 37, 244, 255],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 180, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 154, 115, 123, 28, 170, 113, 84, 100, 227, 189, 34, 255, 18, 171, 37, 191, 214, 20, 4, 107, 181, 53, 74, 244, 106, 117, 57, 231, 40, 126, 29, 6, 185, 61, 87, 11, 119, 13, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 180, 233, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 127, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 115, 123, 28, 170, 113, 84, 100, 154, 227, 181, 34, 255, 18, 171, 37, 6, 189, 214, 231, 29, 4, 40, 74, 20, 61, 11, 191, 117, 126, 106, 185, 244, 107, 53, 57, 87, 119, 13, 135],
		[85, 163, 253, 94, 184, 33, 69, 212, 68, 51, 122, 89, 246, 136, 201, 83, 167, 250, 238, 90, 157, 128, 124, 92, 150, 223, 35, 144, 96, 95, 112, 105, 139, 210, 137, 59, 24, 161, 1, 43, 165, 118, 110, 148, 240, 121, 198, 169, 55, 63, 17, 147, 162, 228, 156, 192, 179, 47, 208, 81, 143, 98, 215, 230, 131, 127, 239, 133, 72, 152, 193, 164, 120, 7, 188, 216, 116, 166, 140, 64, 129, 177, 38, 54, 31, 60, 196, 186, 0, 224, 242, 251, 134, 176, 254, 236, 101, 5, 41, 142, 62, 39, 19, 218, 23, 190, 200, 9, 209, 226, 21, 108, 66, 103, 42, 180, 56, 146, 58, 145, 158, 12, 25, 75, 194, 130, 93, 14, 222, 114, 233, 138, 207, 8, 30, 2, 149, 79, 241, 10, 173, 48, 168, 27, 160, 219, 155, 153, 159, 178, 221, 172, 111, 213, 99, 50, 235, 204, 82, 26, 80, 76, 109, 183, 195, 199, 203, 234, 252, 245, 248, 71, 70, 78, 104, 174, 232, 202, 46, 65, 49, 217, 206, 197, 211, 77, 125, 15, 3, 229, 225, 220, 91, 16, 237, 44, 175, 205, 67, 73, 132, 151, 182, 36, 22, 249, 102, 88, 247, 141, 52, 32, 243, 86, 97, 187, 45, 154, 115, 123, 28, 170, 113, 84, 100, 227, 189, 34, 255, 18, 171, 37, 191, 214, 20, 4, 181, 107, 53, 74, 126, 40, 231, 13, 87, 117, 11, 6, 244, 61, 29, 119, 106, 185, 57, 135]
	]

	sboxes_8_8 = []
	for mapping in mappings_8_8:
		sboxes_8_8.append(SBox(8, 8, mapping))

	return sboxes_8_8


"""
	Generates FHE_Round object for Fiestel type rounds
"""
def getFiestelRound():
	conf = getSBoxes6x4()
	exp  = [ 32,   1,	2,	3,	4,	5, 
			  4,   5,	6,	7,	8,	9,
			  8,   9,  10, 11, 12, 13, 
			 12,  13,  14, 15, 16, 17,
			 16,  17,  18, 19, 20, 21,
			 20,  21,  22, 23, 24, 25,
			 24,  25,  26, 27, 28, 29,
			 28,  29,  30, 31, 32,  1
		   ]
	perm = [
			 1, 17, 33, 49,
			50,  2, 18, 34,
			35, 51,  3, 19, 
			20, 36, 52,  4,
			 5, 21, 37, 53,
			54,  6, 22, 38,
			39, 55,  7, 23,
			24, 40, 53,  8,
			 9, 25, 41, 57,
			58, 10, 26, 42,
			43, 59, 11, 27,
			28, 44, 60, 12,
			13, 29, 45, 61,
			62, 14, 30, 46,
			47, 63, 15, 31,
			32, 48, 64, 16
		   ]

	return FHE_Round(exp, conf, perm)


"""
	Generates FHE_Round object for SPN type rounds
"""
def getSPNRound():
	conf = getSBoxes8x8()
	exp  = range(1, 64, 1)
	perm = [
			1, 17, 33, 49, 65, 81, 97, 113,
			114, 2, 18, 34, 50, 66, 82, 98,
			99, 115, 3, 19, 35, 51, 67, 83,
			84, 100, 116, 4, 20, 36, 52, 68,
			69, 85, 101, 117, 5, 21, 37, 53,
			54, 70, 86, 102, 118, 6, 22, 38,
			39, 55, 71, 87, 103, 119, 7, 23,
			24, 40, 56, 72, 88, 104, 120, 8,
			9, 25, 41, 57, 73, 89, 105, 121,
			122, 10, 26, 42, 58, 74, 90, 106,
			107, 123, 11, 27, 43, 59, 75, 91,
			92, 108, 124, 12, 28, 44, 60, 76,
			77, 93, 109, 125, 13, 29, 45, 61,
			62, 78, 94, 110, 126, 14, 30, 46,
			47, 63, 79, 95, 111, 127, 15, 31,
			32, 48, 64, 80, 96, 112, 128, 16		   
		   ]

	return FHE_Round(exp, conf, perm)


"""
	Greedy weakest trail
"""
def getWeakestTrail(round_pattern, ip, debug=False):
	net_bias = 1
	spn_round = getSPNRound()
	ftl_round = getFiestelRound()
	
	# Select initial ip_bits
	ip_bits = ip

	# Iterate across rounds
	for idx, rtype in enumerate(round_pattern):
		if debug:
			print "Ip bits: ", ip_bits

		# Computation for SPN rounds
		if rtype == 'spn':
			
			confusion_possibilities = spn_round.confuse(ip_bits, 'dat')
			ip_bits = []
			for i, sbox_possibilies in enumerate(confusion_possibilities):
				if not len(sbox_possibilies):
					continue

				"""
				filtered_list = [(x,y) for x,y in sbox_possibilies if (x==1 or x==2 or x ==4 or x==8 or x==16 or x==32 or x==64 or x==128)]
				if debug:
					print filtered_list
				if not len(filtered_list):
					return 0
				"""
				filtered_list = sbox_possibilies

				sorted(filtered_list, lambda x,y: -1 if x[1] < y[1] else 0 if x[1] == y[1] else 1)
				if debug:
					print "Best confusion possibility: ", filtered_list[-1], " at round ", idx, " sbox #", i
				net_bias *= filtered_list[-1][1]
				ip_bits   += [j + i*8 + 1 for j, ch in enumerate("{0:08b}".format(filtered_list[-1][0])) if ch=='1'] 

			if debug:
				print "UnPermuted op bits: ", ip_bits
				print "Permuted op bits: ", spn_round.permute(ip_bits)
			ip_bits = spn_round.permute(ip_bits)

		# Computation for Fiestel rounds
		elif rtype == 'fiestel':
			
			pass			

		else:
			return None

	return net_bias

def weakestTrailWrapper(debug):
	max_bias = 0
	for i in tqdm(range(1, 129)):
		bias = getWeakestTrail(['spn']*8, [i], debug)
		max_bias = max(max_bias, bias)
		print "At initial ip_diff = {0:3}, bias = {1}".format(i, bias)

	return max_bias

mb = weakestTrailWrapper(False)
print "Max Bias = ", mb 